version: 0.1

env:
  variables:
    IMAGE_REPO_NAME: bwapp   #ECR ì €ì¥ì†Œ ì´ë¦„
    IMAGE_TAG: latest        #ECR ì €ì¥ì†Œ ì´ë¯¸ì§€ íƒœê·¸
  secrets-manager:
    AWS_REGION: "ap-northeast-2"  #AWS ë¦¬ì „ (ì„œìš¸ë¡œ ì„¤ì •)

phases:
  pre_build:
    commands:
      - echo Pre-build phase started.  #ë¬¸ìì—´ ë‹¨ìˆœ ì¶œë ¥
      #AWS CLIì— ìš”ì²­í•˜ì—¬ ECR ë¡œê·¸ì¸ì— ì‚¬ìš©í•  ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¶œë ¥ | ì•ì˜ ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ docker loginì„ í†µí•´ ì—°ë™
      - aws ecr get-login-password --region $AWS_REGION | docker login --username AWS --password-stdin $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com
      
  build:
    commands:
      - echo Build phase started.
      - docker build -t $IMAGE_REPO_NAME:$IMAGE_TAG .  #Dockerfileì„ ì´ìš©í•˜ì—¬ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì´ë¯¸ì§€ë¡œ ë¹Œë“œ
      - docker tag $IMAGE_REPO_NAME:$IMAGE_TAG $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/$IMAGE_REPO_NAME:$IMAGE_TAG  #ECR ì €ì¥ì†Œ ì£¼ì†Œì— ë§ê²Œ ì´ë¯¸ì§€ íƒœê·¸ ì„¤ì •
      
  post_build:
    commands:
      - echo ğŸ“¦ Post-build phase started.
      - docker push $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com/$IMAGE_REPO_NAME:$IMAGE_TAG  #ë¹Œë“œëœ Docker ì´ë¯¸ì§€ë¥¼ ECRì— í‘¸ì‹œ
      
artifacts:
  files:
    - '**/*'
